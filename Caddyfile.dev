#{
#	acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
#}

<<<<<<< HEAD:Caddyfile.dev
localhost {
=======
nsn.nz, www.nsn.nz {
>>>>>>> c6c3d0fecc21fb108cd37fc426a2bf0660176ee7:Caddyfile
	encode gzip
	file_server {
		root /static/	
	}
	reverse_proxy /api/* api_service:3000
	reverse_proxy /indexes/* search:7700
	reverse_proxy /search/* search:7700
	log {
        output file /static/analytics/access.log {
            roll_keep_for 2160h
        }
        format json
	}
	@websockets {
		header Connection *Upgrade*
		header Upgrade    websocket
	}
	reverse_proxy @websockets analytics:7890

<<<<<<< HEAD:Caddyfile.dev
=======

>>>>>>> c6c3d0fecc21fb108cd37fc426a2bf0660176ee7:Caddyfile
	@subject {
		path_regexp /subject/(\d+)
	}
	rewrite @subject /subject/

	@standard {
		path_regexp /standard/(\d+)
	}
	rewrite @standard /standard/
}
